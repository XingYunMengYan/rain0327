<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>卡牌图鉴 - 四路线卡牌对战</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/papaparse@5.4.1/papaparse.min.js"></script>
    <style>
        /* 隐藏滚动条但保持功能 */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // --- 核心配置 ---
        const RARITY_ORDER = ['Common', 'Rare', 'Epic', 'Legendary'];
        
        // 音效管理器 (保持不变)
        const SoundManager = {
          context: null,
          bgm: null,
          isMuted: false,
          bgmEnabled: false,
          bgmTimeout: null,
          currentBGMSource: null,
          bgmFiles: ['bgm/bgm1.mp3', 'bgm/bgm2.mp3', 'bgm/bgm3.mp3', 'bgm/bgm4.mp3', 'bgm/bgm5.mp3'],
          lastPlayedIndex: -1,

          init() {
            if (!this.context) {
              this.context = new (window.AudioContext || window.webkitAudioContext)();
            }
          },

          playSound(type) {
            if (this.isMuted) return;
            this.init();

            const ctx = this.context;
            const oscillator = ctx.createOscillator();
            const gainNode = ctx.createGain();

            oscillator.connect(gainNode);
            gainNode.connect(ctx.destination);

            switch(type) {
              case 'click':
                oscillator.frequency.value = 800;
                gainNode.gain.setValueAtTime(0.1, ctx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.1);
                oscillator.start(ctx.currentTime);
                oscillator.stop(ctx.currentTime + 0.1);
                break;
              
              case 'hover':
                oscillator.frequency.value = 600;
                gainNode.gain.setValueAtTime(0.05, ctx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.1);
                oscillator.start(ctx.currentTime);
                oscillator.stop(ctx.currentTime + 0.1);
                break;
            }
          },

           toggleBGM() {
    this.bgmEnabled = !this.bgmEnabled;
    this.bgmEnabled ? this.playBGM() : this.stopBGM();
    localStorage.setItem('bgmEnabled', this.bgmEnabled);
  },

  async playBGM() {
    if (this.isMuted || !this.bgmEnabled) return;
    this.init();
    
    // 随机选择一首BGM（避免重复播放同一首）
    let randomIndex;
    do {
      randomIndex = Math.floor(Math.random() * this.bgmFiles.length);
    } while (randomIndex === this.lastPlayedIndex && this.bgmFiles.length > 1);
    
    this.lastPlayedIndex = randomIndex;
    const bgmPath = this.bgmFiles[randomIndex];

    try {
      // 加载音频文件
      const response = await fetch(bgmPath);
      const arrayBuffer = await response.arrayBuffer();
      const audioBuffer = await this.context.decodeAudioData(arrayBuffer);

      // 创建音频源
      const source = this.context.createBufferSource();
      const gainNode = this.context.createGain();
      
      source.buffer = audioBuffer;
      gainNode.gain.value = 0.1; // 音量
      
      source.connect(gainNode);
      gainNode.connect(this.context.destination);

      // 播放结束后自动播放下一首
      source.onended = () => {
        if (this.bgmEnabled && !this.isMuted) {
          this.playBGM();
        }
      };

      this.currentBGMSource = source;
      source.start(0);
    } catch (error) {
      console.error('BGM加载失败:', error);
    }
  },

  stopBGM() {
    if (this.currentBGMSource) {
      try {
        this.currentBGMSource.stop();
        this.currentBGMSource.disconnect();
      } catch (e) {
        // 忽略已停止的source错误
      }
      this.currentBGMSource = null;
    }
    if (this.bgmTimeout) {
      clearTimeout(this.bgmTimeout);
      this.bgmTimeout = null;
    }
  },

  toggleMute() {
    this.isMuted = !this.isMuted;
    this.isMuted ? this.stopBGM() : (this.bgmEnabled && this.playBGM());
  },

  // 页面加载时恢复上次BGM状态（需在页面ready后调用一次）
  restoreFromStorage() {
    if (localStorage.getItem('bgmEnabled') === 'true') {
      this.bgmEnabled = true;
      // 浏览器要求首次交互后才能播音
      document.addEventListener('click', () => {
        if (this.bgmEnabled && !this.currentBGMSource) this.playBGM();
      }, { once: true });
    }
  }
};

        const savedBgmState = localStorage.getItem('bgmEnabled');
        if (savedBgmState === 'true') {
            SoundManager.bgmEnabled = true;
            document.addEventListener('click', () => {
                if (SoundManager.bgmEnabled && !SoundManager.bgmTimeout) {
                    SoundManager.playBGM();
                }
            }, { once: true });
        }

        // --- SVG 图标组件 ---
        const Sword = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}>
                <path d="M14.5 17.5L3 6V3h3l11.5 11.5" />
                <path d="M13 19l6-6" />
                <path d="M16 16l4 4" />
                <path d="M19 21l2-2" />
            </svg>
        );

        const Heart = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}>
                <path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z" />
            </svg>
        );

        const Coins = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}>
                <circle cx="8" cy="8" r="6" />
                <path d="M18.09 10.37A6 6 0 1 1 10.34 18" />
                <path d="M7 6h1v4" />
            </svg>
        );

        const Sparkles = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}>
                <path d="M12 3v18M3 12h18M6.5 6.5l11 11M6.5 17.5l11-11" />
            </svg>
        );

        const X = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}>
                <line x1="18" y1="6" x2="6" y2="18" />
                <line x1="6" y1="6" x2="18" y2="18" />
            </svg>
        );

        const Home = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}>
                <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" />
                <polyline points="9 22 9 12 15 12 15 22" />
            </svg>
        );

        const Volume2 = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}>
                <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5" />
                <path d="M15.54 8.46a5 5 0 0 1 0 7.07" />
                <path d="M19.07 4.93a10 10 0 0 1 0 14.14" />
            </svg>
        );

        const VolumeX = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}>
                <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5" />
                <line x1="23" y1="9" x2="17" y2="15" />
                <line x1="17" y1="9" x2="23" y2="15" />
            </svg>
        );

        const FilterIcon = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}>
                <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3" />
            </svg>
        );

        const CardList = () => {
          const [allCards, setAllCards] = useState([]);
          const [filteredCards, setFilteredCards] = useState([]);
          const [selectedCard, setSelectedCard] = useState(null);
          const [filters, setFilters] = useState({
            type: 'all',
            rarity: 'all',
            stRace: 'all',
            ndRace: 'all',
            search: ''
          });
          const [isFiltersOpen, setIsFiltersOpen] = useState(false); // 移动端筛选折叠状态
          const [isMuted, setIsMuted] = useState(false);
          const [bgmEnabled, setBgmEnabled] = useState(() => {
            const saved = localStorage.getItem('bgmEnabled');
            return saved === 'true';
          });

          useEffect(() => {
            fetch('./card_data.csv')
              .then(response => response.text())
              .then(csvText => {
                Papa.parse(csvText, {
                  header: true,
                  skipEmptyLines: true,
                  complete: (results) => {
                    const cards = results.data.map(row => {
                      let hp = row.hp;
                      if (hp === '?') hp = 0;
                      
                      return {
                        id: parseInt(row['#']),
                        name: row.name,
                        type: row.type ? row.type.toLowerCase() : 'unknown', // 确保统一小写
                        rarity: row.rarity || '',
                        stRace: row.stRace || '',
                        ndRace: row.ndRace || '',
                        cost: parseFloat(row.cost) || 0,
                        hp: parseInt(hp) || 0,
                        atk: parseInt(row.atk) || 0,
                        effect: row.effect || ''
                      };
                    }).filter(card => card.id && card.name);
                    
                    cards.sort((a, b) => a.id - b.id);
                    setAllCards(cards);
                    setFilteredCards(cards);
                  }
                });
              })
              .catch(error => {
                console.error('加载卡牌数据失败:', error);
                // 仅开发测试用数据
                // setAllCards([]); 
              });
          }, []);

          useEffect(() => {
            if (bgmEnabled) {
              SoundManager.bgmEnabled = true;
              const startBGM = () => {
                if (SoundManager.bgmEnabled && !SoundManager.bgmTimeout) {
                  SoundManager.playBGM();
                }
                document.removeEventListener('click', startBGM);
              };
              document.addEventListener('click', startBGM);
            }
          }, [bgmEnabled]);

          useEffect(() => {
            let filtered = allCards;

            if (filters.type !== 'all') {
              filtered = filtered.filter(card => card.type === filters.type);
            }
            if (filters.rarity !== 'all') {
              filtered = filtered.filter(card => card.rarity === filters.rarity);
            }
            if (filters.stRace !== 'all') {
              filtered = filtered.filter(card => card.stRace === filters.stRace);
            }
            if (filters.ndRace !== 'all') {
              filtered = filtered.filter(card => card.ndRace === filters.ndRace);
            }
            if (filters.search) {
              const searchLower = filters.search.toLowerCase();
              filtered = filtered.filter(card => 
                card.name.toLowerCase().includes(searchLower) ||
                card.effect.toLowerCase().includes(searchLower)
              );
            }

            setFilteredCards(filtered);
          }, [filters, allCards]);

          // 获取已排序的稀有度列表
          const getSortedRarities = () => {
             const existingRarities = [...new Set(allCards.map(c => c.rarity).filter(Boolean))];
             // 按照 RARITY_ORDER 的索引排序，找不到的排在最后
             return existingRarities.sort((a, b) => {
                const indexA = RARITY_ORDER.indexOf(a);
                const indexB = RARITY_ORDER.indexOf(b);
                const valA = indexA === -1 ? 999 : indexA;
                const valB = indexB === -1 ? 999 : indexB;
                return valA - valB;
             });
          };

          const getUniqueValues = (field) => {
            const values = [...new Set(allCards.map(card => card[field]).filter(v => v))];
            return values.sort();
          };

          const toggleMute = () => {
            SoundManager.toggleMute();
            setIsMuted(SoundManager.isMuted);
          };

          const toggleBGM = () => {
            SoundManager.toggleBGM();
            setBgmEnabled(SoundManager.bgmEnabled);
          };

          const getCardColor = (type) => {
            switch(type) {
      
              case 'support': return 'from-green-600 to-green-800';
              case 'miracle': return 'from-purple-600 to-purple-800';
              case 'battlefield': return 'from-red-600 to-red-800'; // 战场配色
              default: return 'from-gray-600 to-gray-800';
            }
          };

          const getTypeText = (type) => {
            switch(type) {
              
              case 'support': return '支援';
              case 'miracle': return '奇迹';
              case 'battlefield': return '战场'; // 修正战场显示
              default: return type;
            }
          };

          const getRarityColor = (rarity) => {
            switch(rarity) {
              case 'Common': return 'text-gray-400';
              case 'Rare': return 'text-blue-400';
              case 'Epic': return 'text-purple-400';
              case 'Legendary': return 'text-yellow-400';
              default: return 'text-gray-400';
            }
          };

          const getCardImagePath = (cardId) => `card_images/${cardId}.png`;

          const handleImageError = (e) => {
            e.target.style.display = 'none';
            if (e.target.nextSibling) e.target.nextSibling.style.display = 'flex';
          };

          const handleImageLoad = (e) => {
            e.target.style.display = 'block';
            if (e.target.nextSibling) e.target.nextSibling.style.display = 'none';
          };

          const renderSmallCard = (card) => (
            <div
              key={card.id}
              onClick={() => {
                SoundManager.playSound('click');
                setSelectedCard(card);
              }}
              onMouseEnter={() => SoundManager.playSound('hover')}
              className={`
                relative bg-gradient-to-br ${getCardColor(card.type)} 
                rounded-lg p-2 md:p-3 cursor-pointer transform transition-all duration-200 
                hover:scale-105 hover:shadow-xl border-2 border-gray-700
                flex flex-col h-full
              `}
            >
              <div className="text-white text-xs mb-1 flex justify-between items-center">
                <span className="font-bold opacity-70">#{card.id}</span>
                <span className={`font-bold ${getRarityColor(card.rarity)} scale-90 origin-right`}>
                  {card.rarity}
                </span>
              </div>
              <div className="text-white font-bold text-sm mb-2 truncate">{card.name}</div>
              
              <div className="relative w-full aspect-square mb-2 rounded overflow-hidden bg-gray-900 bg-opacity-50">
                <img 
                  src={getCardImagePath(card.id)}
                  alt={card.name}
                  onError={handleImageError}
                  onLoad={handleImageLoad}
                  className="w-full h-full object-cover"
                  style={{ display: 'none' }}
                />
                <div className="w-full h-full flex items-center justify-center" style={{ display: 'flex' }}>
                  <Sparkles size={24} className="text-gray-600" />
                </div>
              </div>
              
              <div className="text-yellow-300 text-xs mb-1">{getTypeText(card.type)}</div>
              
              <div className="mt-auto flex justify-between items-center text-white text-sm">
                <div className="flex items-center gap-1">
                  <Coins size={12} className="text-yellow-400" />
                  <span>{card.cost}</span>
                </div>
                {card.type ==='battlefield' && (
                  <>
                    <div className="flex items-center gap-1">
                      <Sword size={12} className="text-red-400" />
                      <span>{card.atk}</span>
                    </div>
                    <div className="flex items-center gap-1">
                      <Heart size={12} className="text-pink-400" />
                      <span>{card.hp}</span>
                    </div>
                  </>
                )}
              </div>
            </div>
          );

          // 详情页
          const renderDetailCard = (card) => (
            <div className="fixed inset-0 bg-black bg-opacity-80 z-50 flex items-center justify-center p-0 md:p-4 backdrop-blur-sm animate-fade-in">
              <div className="w-full h-full md:h-auto md:max-w-6xl md:max-h-[90vh] flex flex-col md:flex-row gap-0 md:gap-8 bg-gray-900 md:bg-transparent md:p-0">
                
                {/* 顶部关闭按钮（移动端） */}
                <button
                    onClick={() => {
                        SoundManager.playSound('click');
                        setSelectedCard(null);
                    }}
                    className="absolute top-4 right-4 z-[60] p-2 bg-black bg-opacity-50 rounded-full md:hidden text-white"
                >
                    <X size={24} />
                </button>

                {/* 左侧：大卡牌 */}
                <div className="w-full md:w-1/3 flex-shrink-0 relative">
                  <div className={`
                    h-full md:h-auto
                    bg-gradient-to-br ${getCardColor(card.type)} 
                    md:rounded-2xl p-6 md:p-8 shadow-2xl border-b-4 md:border-4 border-yellow-500
                    flex flex-col justify-center
                  `}>
                    <div className="text-white text-sm mb-2 flex justify-between items-center">
                      <span className="font-bold text-lg opacity-70">#{card.id}</span>
                      <span className={`font-bold text-lg ${getRarityColor(card.rarity)}`}>
                        {card.rarity}
                      </span>
                    </div>
                    <div className="text-white font-bold text-3xl mb-2">{card.name}</div>
                    <div className="text-yellow-300 text-xl mb-4">{getTypeText(card.type)}</div>
                    
                    <div className="mb-4 flex gap-2 flex-wrap">
                      {card.stRace && (
                        <span className="px-3 py-1 bg-blue-500 bg-opacity-80 rounded-full text-white text-sm shadow">
                          {card.stRace}
                        </span>
                      )}
                      {card.ndRace && (
                        <span className="px-3 py-1 bg-green-500 bg-opacity-80 rounded-full text-white text-sm shadow">
                          {card.ndRace}
                        </span>
                      )}
                    </div>
                    
                    {/* 卡牌图片 */}
                    <div className="bg-gray-900 bg-opacity-50 rounded-lg mb-4 aspect-square overflow-hidden relative shadow-inner mx-auto w-full max-w-[300px] md:max-w-none">
                      <img 
                        src={getCardImagePath(card.id)}
                        alt={card.name}
                        onError={handleImageError}
                        onLoad={handleImageLoad}
                        className="w-full h-full object-cover"
                        style={{ display: 'none' }}
                      />
                      <div className="w-full h-full flex items-center justify-center flex-col p-4 text-center" style={{ display: 'flex' }}>
                        <Sparkles size={48} className="text-gray-600 mb-2" />
                        <span className="text-gray-500 text-sm">暂无图片</span>
                        <span className="text-gray-600 text-xs hidden md:block mt-1">文件: {card.id}.png</span>
                      </div>
                    </div>
                    
                    <div className="flex justify-around items-center text-white text-2xl border-t-2 border-white border-opacity-20 pt-4">
                      <div className="flex items-center gap-2">
                        <Coins size={24} className="text-yellow-400 drop-shadow" />
                        <span className="font-bold shadow-black drop-shadow-md">{card.cost}</span>
                      </div>
                      {card.type === 'battlefield' && (
                        <>
                          <div className="flex items-center gap-2">
                            <Sword size={24} className="text-red-400 drop-shadow" />
                            <span className="font-bold shadow-black drop-shadow-md">{card.atk}</span>
                          </div>
                          <div className="flex items-center gap-2">
                            <Heart size={24} className="text-pink-400 drop-shadow" />
                            <span className="font-bold shadow-black drop-shadow-md">{card.hp}</span>
                          </div>
                        </>
                      )}
                    </div>
                  </div>
                </div>

                {/* 右侧：详细信息 (可滚动) */}
                <div className="flex-1 bg-gray-800 md:rounded-2xl shadow-2xl overflow-y-auto no-scrollbar md:custom-scrollbar">
                  <div className="p-6 md:p-8 min-h-full">
                      <div className="hidden md:flex justify-between items-start mb-6">
                        <h2 className="text-3xl font-bold text-white">卡牌详情</h2>
                        <button
                          onClick={() => {
                            SoundManager.playSound('click');
                            setSelectedCard(null);
                          }}
                          className="p-2 bg-red-600 hover:bg-red-700 rounded-lg transition-colors"
                        >
                          <X size={24} className="text-white" />
                        </button>
                      </div>

                      <div className="space-y-4 pb-10 md:pb-0">
                        {/* 移动端显示的标题 */}
                        <h3 className="text-yellow-400 font-bold mb-2 text-lg md:hidden">效果详情</h3>

                        {card.effect ? (
                          <div className="bg-gray-700 rounded-lg p-5 border border-gray-600">
                            <p className="text-white leading-relaxed whitespace-pre-wrap text-base md:text-lg">{card.effect}</p>
                          </div>
                        ) : (
                             <div className="bg-gray-700 rounded-lg p-5 border border-gray-600 italic text-gray-400">
                                暂无效果描述
                             </div>
                        )}

                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
                            <div className="bg-gray-700 rounded-lg p-4 border border-gray-600">
                              <h3 className="text-yellow-400 font-bold mb-2">基本数据</h3>
                              <div className="text-gray-200 space-y-1 text-sm">
                                <p className="flex justify-between border-b border-gray-600 pb-1"><span>类型</span> <span>{getTypeText(card.type)}</span></p>
                                <p className="flex justify-between border-b border-gray-600 pb-1 pt-1"><span>费用</span> <span>{card.cost}</span></p>
                                <p className="flex justify-between pt-1"><span>稀有度</span> <span className={getRarityColor(card.rarity)}>{card.rarity}</span></p>
                              </div>
                            </div>
                            
                            {card.type === 'battlefield' && (
                                <div className="bg-gray-700 rounded-lg p-4 border border-gray-600">
                                  <h3 className="text-yellow-400 font-bold mb-2">战斗数据</h3>
                                  <div className="text-gray-200 space-y-1 text-sm">
                                    <p className="flex justify-between border-b border-gray-600 pb-1"><span>攻击力</span> <span className="text-red-300">{card.atk}</span></p>
                                    <p className="flex justify-between pt-1"><span>生命值</span> <span className="text-pink-300">{card.hp}</span></p>
                                  </div>
                                </div>
                            )}
                        </div>
                      </div>
                  </div>
                </div>
              </div>
            </div>
          );

          return (
            <div className="min-h-screen bg-gradient-to-br from-gray-900 via-blue-900 to-purple-900 pb-20 md:pb-0">
              {/* 固定顶部 */}
              <div className="sticky top-0 z-40 bg-gray-900 bg-opacity-95 backdrop-blur-sm shadow-lg border-b border-gray-700">
                {/* 标题栏 */}
                <div className="max-w-7xl mx-auto px-4 py-3 md:py-4">
                  <div className="flex justify-between items-center">
                    <h1 className="text-xl md:text-3xl font-bold text-white flex items-center gap-2">
                      <Sparkles size={24} className="text-yellow-400 md:w-8 md:h-8" />
                      <span className="hidden md:inline">卡牌图鉴</span>
                      <span className="md:hidden">图鉴</span>
                    </h1>
                    
                    <div className="flex gap-2">
                       {/* 移动端筛选开关 */}
                      <button
                        onClick={() => setIsFiltersOpen(!isFiltersOpen)}
                        className={`md:hidden px-3 py-2 ${isFiltersOpen ? 'bg-blue-600' : 'bg-gray-700'} text-white rounded-lg transition-colors`}
                      >
                         <FilterIcon size={20} />
                      </button>

                      <button
                        onClick={() => {
                          SoundManager.playSound('click');
                          window.location.href = 'index.html';
                        }}
                        className="px-3 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg font-bold flex items-center gap-1 md:gap-2 text-sm md:text-base"
                      >
                        <Home size={18} className="md:w-5 md:h-5" />
                        <span className="hidden md:inline">主界面</span>
                      </button>
                      <button
                        onClick={toggleMute}
                        className="px-3 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg font-bold"
                      >
                        {isMuted ? <VolumeX size={18} className="md:w-5 md:h-5"/> : <Volume2 size={18} className="md:w-5 md:h-5"/>}
                      </button>
                      <button
                        onClick={toggleBGM}
                        className={`px-3 py-2 ${bgmEnabled ? 'bg-green-600 hover:bg-green-700' : 'bg-gray-600 hover:bg-gray-700'} text-white rounded-lg font-bold text-sm md:text-base`}
                      >
                        BGM
                      </button>
                    </div>
                  </div>
                </div>

                {/* 筛选栏 (响应式折叠) */}
                <div className={`${isFiltersOpen ? 'block' : 'hidden'} md:block bg-gray-800 md:bg-transparent border-t border-gray-700 md:border-none shadow-xl md:shadow-none`}>
                    <div className="max-w-7xl mx-auto px-4 py-4">
                      <div className="grid grid-cols-2 md:grid-cols-5 gap-3">
                        {/* 搜索框 */}
                        <input
                          type="text"
                          placeholder="搜索..."
                          value={filters.search}
                          onChange={(e) => setFilters({...filters, search: e.target.value})}
                          className="col-span-2 md:col-span-1 px-4 py-2 bg-gray-700 text-white rounded-lg border border-gray-600 focus:border-blue-500 focus:outline-none text-sm"
                        />

                        {/* 类型筛选 */}
                        <select
                          value={filters.type}
                          onChange={(e) => setFilters({...filters, type: e.target.value})}
                          className="col-span-1 px-3 py-2 bg-gray-700 text-white rounded-lg border border-gray-600 focus:border-blue-500 focus:outline-none text-sm"
                        >
                          <option value="all">所有类型</option>
                          <option value="battlefield">战场</option>
                          <option value="support">支援</option>
                          <option value="miracle">奇迹</option>
                          
                        </select>

                        {/* 稀有度筛选 (排序修正) */}
                        <select
                          value={filters.rarity}
                          onChange={(e) => setFilters({...filters, rarity: e.target.value})}
                          className="col-span-1 px-3 py-2 bg-gray-700 text-white rounded-lg border border-gray-600 focus:border-blue-500 focus:outline-none text-sm"
                        >
                          <option value="all">所有稀有度</option>
                          {getSortedRarities().map(rarity => (
                            <option key={rarity} value={rarity}>{rarity}</option>
                          ))}
                        </select>

                        {/* 主种族筛选 */}
                        <select
                          value={filters.stRace}
                          onChange={(e) => setFilters({...filters, stRace: e.target.value})}
                          className="col-span-1 px-3 py-2 bg-gray-700 text-white rounded-lg border border-gray-600 focus:border-blue-500 focus:outline-none text-sm"
                        >
                          <option value="all">所有主种族</option>
                          {getUniqueValues('stRace').map(race => (
                            <option key={race} value={race}>{race}</option>
                          ))}
                        </select>

                        {/* 清除按钮 */}
                        <button
                          onClick={() => {
                            SoundManager.playSound('click');
                            setFilters({ type: 'all', rarity: 'all', stRace: 'all', ndRace: 'all', search: '' });
                          }}
                          className="col-span-2 md:col-span-1 px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg font-bold text-sm transition-colors"
                        >
                          重置筛选
                        </button>
                      </div>

                      {/* 统计信息 */}
                      <div className="mt-3 flex justify-between items-center text-gray-400 text-xs md:text-sm px-1">
                        <span>共找到 <span className="text-yellow-400 font-bold">{filteredCards.length}</span> 张卡牌</span>
                      </div>
                    </div>
                </div>
              </div>

              {/* 卡牌列表 */}
              <div className="max-w-7xl mx-auto px-2 md:px-4 py-4 md:py-6">
                {filteredCards.length === 0 ? (
                  <div className="text-center py-20">
                    <div className="text-gray-400 text-xl mb-4">没有找到符合条件的卡牌</div>
                    <button
                      onClick={() => setFilters({ type: 'all', rarity: 'all', stRace: 'all', ndRace: 'all', search: '' })}
                      className="px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-bold"
                    >
                      显示所有卡牌
                    </button>
                  </div>
                ) : (
                  <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-3 md:gap-4">
                    {filteredCards.map(card => renderSmallCard(card))}
                  </div>
                )}
              </div>

              {/* 详情弹窗 */}
              {selectedCard && renderDetailCard(selectedCard)}
            </div>
          );
        };

        ReactDOM.render(<CardList />, document.getElementById('root'));
    </script>
</body>
</html>
