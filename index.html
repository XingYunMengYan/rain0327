<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å››è·¯çº¿å¡ç‰Œå¯¹æˆ˜ - ä¸»èœå•</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900">
    <div id="root"></div>

    <script>
        // éŸ³æ•ˆç®¡ç†å™¨ï¼ˆä¸æ¸¸æˆä¸­ç›¸åŒï¼‰
        const SoundManager = {
          context: null,
          bgm: null,
          isMuted: false,
          bgmEnabled: false,
            bgmTimeout: null,
            currentBGMSource: null,
            bgmFiles: ['bgm/bgm1.mp3', 'bgm/bgm2.mp3', 'bgm/bgm3.mp3', 'bgm/bgm4.mp3', 'bgm/bgm5.mp3'],
            lastPlayedIndex: -1,

          init() {
            if (!this.context) {
              this.context = new (window.AudioContext || window.webkitAudioContext)();
            }
          },

          // æ’­æ”¾ç®€å•éŸ³æ•ˆ
          playSound(type) {
            if (this.isMuted) return;
            this.init();

            const ctx = this.context;
            const oscillator = ctx.createOscillator();
            const gainNode = ctx.createGain();

            oscillator.connect(gainNode);
            gainNode.connect(ctx.destination);

            switch(type) {
              case 'click':
                oscillator.frequency.value = 800;
                gainNode.gain.setValueAtTime(0.1, ctx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.1);
                oscillator.start(ctx.currentTime);
                oscillator.stop(ctx.currentTime + 0.1);
                break;
              
              case 'hover':
                oscillator.frequency.value = 600;
                gainNode.gain.setValueAtTime(0.08, ctx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.15);
                oscillator.start(ctx.currentTime);
                oscillator.stop(ctx.currentTime + 0.15);
                break;
            }
          },

          // åˆ‡æ¢BGM
            toggleBGM() {
    this.bgmEnabled = !this.bgmEnabled;
    this.bgmEnabled ? this.playBGM() : this.stopBGM();
    localStorage.setItem('bgmEnabled', this.bgmEnabled);
  },

  async playBGM() {
    if (this.isMuted || !this.bgmEnabled) return;
    this.init();
    
    // éšæœºé€‰æ‹©ä¸€é¦–BGMï¼ˆé¿å…é‡å¤æ’­æ”¾åŒä¸€é¦–ï¼‰
    let randomIndex;
    do {
      randomIndex = Math.floor(Math.random() * this.bgmFiles.length);
    } while (randomIndex === this.lastPlayedIndex && this.bgmFiles.length > 1);
    
    this.lastPlayedIndex = randomIndex;
    const bgmPath = this.bgmFiles[randomIndex];

    try {
      // åŠ è½½éŸ³é¢‘æ–‡ä»¶
      const response = await fetch(bgmPath);
      const arrayBuffer = await response.arrayBuffer();
      const audioBuffer = await this.context.decodeAudioData(arrayBuffer);

      // åˆ›å»ºéŸ³é¢‘æº
      const source = this.context.createBufferSource();
      const gainNode = this.context.createGain();
      
      source.buffer = audioBuffer;
      gainNode.gain.value = 0.1; // éŸ³é‡
      
      source.connect(gainNode);
      gainNode.connect(this.context.destination);

      // æ’­æ”¾ç»“æŸåè‡ªåŠ¨æ’­æ”¾ä¸‹ä¸€é¦–
      source.onended = () => {
        if (this.bgmEnabled && !this.isMuted) {
          this.playBGM();
        }
      };

      this.currentBGMSource = source;
      source.start(0);
    } catch (error) {
      console.error('BGMåŠ è½½å¤±è´¥:', error);
    }
  },

  stopBGM() {
    if (this.currentBGMSource) {
      try {
        this.currentBGMSource.stop();
        this.currentBGMSource.disconnect();
      } catch (e) {
        // å¿½ç•¥å·²åœæ­¢çš„sourceé”™è¯¯
      }
      this.currentBGMSource = null;
    }
    if (this.bgmTimeout) {
      clearTimeout(this.bgmTimeout);
      this.bgmTimeout = null;
    }
  },

  toggleMute() {
    this.isMuted = !this.isMuted;
    this.isMuted ? this.stopBGM() : (this.bgmEnabled && this.playBGM());
  },

  // é¡µé¢åŠ è½½æ—¶æ¢å¤ä¸Šæ¬¡BGMçŠ¶æ€ï¼ˆéœ€åœ¨é¡µé¢readyåè°ƒç”¨ä¸€æ¬¡ï¼‰
  restoreFromStorage() {
    if (localStorage.getItem('bgmEnabled') === 'true') {
      this.bgmEnabled = true;
      // æµè§ˆå™¨è¦æ±‚é¦–æ¬¡äº¤äº’åæ‰èƒ½æ’­éŸ³
      document.addEventListener('click', () => {
        if (this.bgmEnabled && !this.currentBGMSource) this.playBGM();
      }, { once: true });
    }
  }
};

        // ä»localStorageæ¢å¤BGMè®¾ç½®
        const savedBgmState = localStorage.getItem('bgmEnabled');
        if (savedBgmState === 'true') {
            SoundManager.bgmEnabled = true;
            // å»¶è¿Ÿå¯åŠ¨BGMï¼Œç­‰å¾…ç”¨æˆ·äº¤äº’
            document.addEventListener('click', () => {
                if (SoundManager.bgmEnabled && !SoundManager.bgmTimeout) {
                    SoundManager.playBGM();
                }
            }, { once: true });
        }

        // SVGå›¾æ ‡ç»„ä»¶
        const VolumeIcon = ({ enabled, size = 24 }) => {
            if (enabled) {
                return `<svg width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5" />
                    <path d="M15.54 8.46a5 5 0 0 1 0 7.07" />
                    <path d="M19.07 4.93a10 10 0 0 1 0 14.14" />
                </svg>`;
            } else {
                return `<svg width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5" />
                    <line x1="23" y1="9" x2="17" y2="15" />
                    <line x1="17" y1="9" x2="23" y2="15" />
                </svg>`;
            }
        };

        // æ¸²æŸ“ä¸»èœå•
        function renderMenu() {
            const menuItems = [
                {
                    title: 'ç»ƒä¹ æ¨¡å¼',
                    description: 'ç†Ÿæ‚‰æ¸¸æˆè§„åˆ™ä¸å¡ç‰ŒåŠŸèƒ½',
                    color: 'from-blue-600 to-purple-600',
                    icon: 'âš”ï¸',
                    action: () => {
                        SoundManager.playSound('click');
                        window.location.href = 'localGame.html';
                    }
                },
                {
                    title: 'AIå¯¹æˆ˜',
                    description: 'ä¸ç”µè„‘AIè¿›è¡Œå¯¹æˆ˜',
                    color: 'from-green-600 to-teal-600',
                    icon: 'ğŸ¤–',
                    action: () => {
                        SoundManager.playSound('click');
                        window.location.href = 'gameAI.html';
                    }
                },
                {
                    title: 'åœ¨çº¿å¯¹æˆ˜',
                    description: 'é€šè¿‡æˆ¿é—´å·ä¸å¥½å‹å¯¹æˆ˜',
                    color: 'from-orange-600 to-red-600',
                    icon: 'ğŸŒ',
                    action: () => {
                        SoundManager.playSound('click');
                        window.location.href = 'gameOnline.html';
                    }
                },
                {
                    title: 'æŸ¥çœ‹æ‰€æœ‰å¡ç‰Œ',
                    description: 'æµè§ˆæ¸¸æˆä¸­çš„å…¨éƒ¨å¡ç‰Œ',
                    color: 'from-purple-600 to-pink-600',
                    icon: 'ğŸ“š',
                    action: () => {
                        SoundManager.playSound('click');
                        window.location.href = 'cardList.html';
                    }
                }
            ];

            const menuHTML = `
                <div class="min-h-screen flex items-center justify-center p-4 bg-gradient-to-br from-gray-900 via-blue-900 to-purple-900">
                    <div class="max-w-4xl w-full">
                        <!-- æ ‡é¢˜ -->
                        <div class="text-center mb-12 animate-fade-in">
                            <h1 class="text-6xl font-bold text-white mb-4 drop-shadow-lg">
                                å››è·¯çº¿å¡ç‰Œå¯¹æˆ˜
                            </h1>
                            <p class="text-xl text-gray-300">é€‰æ‹©æ¸¸æˆæ¨¡å¼å¼€å§‹ä½ çš„å†’é™©</p>
                        </div>

                        <!-- èœå•ç½‘æ ¼ -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                            ${menuItems.map((item, index) => `
                                <button 
                                    onclick="handleMenuClick(${index})"
                                    onmouseenter="SoundManager.playSound('hover')"
                                    class="group relative overflow-hidden rounded-2xl bg-gradient-to-br ${item.color} p-8 text-left transform transition-all duration-300 hover:scale-105 hover:shadow-2xl"
                                >
                                    <div class="relative z-10">
                                        <div class="text-6xl mb-4">${item.icon}</div>
                                        <h2 class="text-3xl font-bold text-white mb-2">${item.title}</h2>
                                        <p class="text-gray-200">${item.description}</p>
                                    </div>
                                    <div class="absolute inset-0 bg-black opacity-0 group-hover:opacity-10 transition-opacity duration-300"></div>
                                </button>
                            `).join('')}
                        </div>

                        <!-- æ§åˆ¶æŒ‰é’® -->
                        <div class="flex justify-center gap-4">
                            <button 
                                id="bgmButton"
                                onclick="toggleBGM()"
                                class="px-6 py-3 bg-gray-700 hover:bg-gray-600 text-white rounded-lg font-bold flex items-center gap-2 transition-all duration-200"
                            >
                                <span id="bgmIcon">${VolumeIcon({ enabled: SoundManager.bgmEnabled, size: 20 })}</span>
                                <span id="bgmText">${SoundManager.bgmEnabled ? 'BGM: å¼€' : 'BGM: å…³'}</span>
                            </button>
                            <button 
                                id="muteButton"
                                onclick="toggleMute()"
                                class="px-6 py-3 bg-gray-700 hover:bg-gray-600 text-white rounded-lg font-bold transition-all duration-200"
                            >
                                <span id="muteText">${SoundManager.isMuted ? 'å–æ¶ˆé™éŸ³' : 'é™éŸ³'}</span>
                            </button>
                        </div>

                        <!-- ç‰ˆæƒä¿¡æ¯ -->
                        <div class="text-center mt-12 text-gray-400 text-sm">
                            <p>Â© 2024 å››è·¯çº¿å¡ç‰Œå¯¹æˆ˜. æ‰€æœ‰æƒåˆ©ä¿ç•™.</p>
                        </div>
                    </div>
                </div>

                <style>
                    @keyframes fade-in {
                        from {
                            opacity: 0;
                            transform: translateY(-20px);
                        }
                        to {
                            opacity: 1;
                            transform: translateY(0);
                        }
                    }
                    .animate-fade-in {
                        animation: fade-in 1s ease-out;
                    }
                </style>
            `;

            document.getElementById('root').innerHTML = menuHTML;
        }

        // èœå•é¡¹ç‚¹å‡»å¤„ç†
        window.handleMenuClick = (index) => {
            const menuItems = [
                () => window.location.href = 'localGame.html',
                () => window.location.href = 'gameAI.html',
                () => window.location.href = 'gameOnline.html',
                () => window.location.href = 'cardList.html'
            ];
            SoundManager.playSound('click');
            menuItems[index]();
        };

        // BGMåˆ‡æ¢
        window.toggleBGM = () => {
            SoundManager.playSound('click');
            SoundManager.toggleBGM();
            document.getElementById('bgmIcon').innerHTML = VolumeIcon({ enabled: SoundManager.bgmEnabled, size: 20 });
            document.getElementById('bgmText').textContent = SoundManager.bgmEnabled ? 'BGM: å¼€' : 'BGM: å…³';
        };

        // é™éŸ³åˆ‡æ¢
        window.toggleMute = () => {
            SoundManager.playSound('click');
            SoundManager.toggleMute();
            document.getElementById('muteText').textContent = SoundManager.isMuted ? 'å–æ¶ˆé™éŸ³' : 'é™éŸ³';
        };

        // é¡µé¢åŠ è½½æ—¶æ¸²æŸ“èœå•
        renderMenu();
    </script>
</body>
</html>
